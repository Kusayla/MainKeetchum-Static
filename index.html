<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A$$ Keetchum - Jeu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/lastversion.css?v=10">
    <link rel="stylesheet" href="css/game.css?v=10">

    <!-- Unown Font -->
    <style>
        @font-face {
            font-family: 'Unown';
            src: url('fonts/Unown.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #74C857;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            background-color: #74C857;
            font-family: 'Press Start 2P', cursive;
        }

        .scrolling-text {
            white-space: nowrap;
            font-size: 40px;
            color: #498248;
            position: absolute;
            width: 100%;
        }

        .scroll-left-right {
            animation: scrollLeftRight 10s linear infinite;
        }

        .scroll-right-left {
            animation: scrollRightLeft 10s linear infinite;
        }

        @keyframes scrollLeftRight {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        @keyframes scrollRightLeft {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }

        /* Bag/Inventory Interface */
        .bag-interface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            font-family: 'Press Start 2P', cursive;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        .bag-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .bag-header h2 {
            font-size: 24px;
            margin: 10px 0;
        }

        .bag-instruction {
            font-size: 10px;
            color: #aaa;
        }

        .bag-content {
            max-height: calc(100% - 100px);
            overflow-y: auto;
        }

        .bag-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            padding: 10px;
        }

        .bag-item {
            background: #333;
            border: 3px solid #666;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bag-item:hover {
            background: #444;
            border-color: #fff;
            transform: scale(1.05);
        }

        .bag-item-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .bag-item-name {
            font-size: 10px;
            word-wrap: break-word;
        }

        .empty-bag-message {
            text-align: center;
            font-size: 14px;
            color: #888;
            padding: 50px 20px;
        }

        /* Item Detail View (Paper) */
        .item-detail-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .paper-container {
            background: #f4e8c1;
            border: 5px solid #8b7355;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            position: relative;
        }

        .paper-content {
            font-family: 'Press Start 2P', cursive;
            color: #2c1810;
        }

        .paper-title {
            text-align: center;
            font-size: 18px;
            margin-bottom: 30px;
            text-decoration: underline;
        }

        .paper-text {
            line-height: 2;
        }

        .paper-text p {
            font-size: 12px;
            margin: 15px 0;
        }

        .password-display {
            background: rgba(139, 115, 85, 0.15);
            border: 4px solid #8b7355;
            padding: 30px 20px;
            margin: 25px 0;
            text-align: center;
            font-size: 40px;
            font-weight: normal;
            color: #1a0d06;
            letter-spacing: 12px;
            font-family: 'Unown', monospace;
            line-height: 2;
            text-transform: lowercase;
            word-break: break-all;
        }

        .password-hint-text {
            font-size: 9px;
            color: #666;
            margin-top: 15px;
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
        }

        .unown-legend {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
        }

        .unown-legend p {
            font-size: 8px;
            color: #999;
            margin: 5px 0;
            text-align: center;
        }

        .paper-hint {
            font-size: 10px;
            font-style: italic;
            text-align: center;
            color: #555;
        }

        .close-paper-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 30px;
            background: #8b7355;
            color: #f4e8c1;
            border: none;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .close-paper-btn:hover {
            background: #6d5a44;
            transform: scale(1.05);
        }

        /* Bag Button (for mobile/gameboy) */
        .bag-button-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .bag-button {
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border: 3px solid #34495e;
            border-radius: 8px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default */
        }

        .bag-button:hover {
            background: #34495e;
            border-color: #7f8c8d;
            transform: scale(1.05);
        }

        .bag-button:active {
            transform: scale(0.95);
        }

        .bag-button i {
            margin-right: 8px;
        }

        /* Item Received Notification */
        .item-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 5px solid #ffd700;
            border-radius: 15px;
            padding: 40px 60px;
            z-index: 10000;
            font-family: 'Press Start 2P', cursive;
            color: white;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            display: none;
        }

        .item-notification-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 0.6s ease-in-out infinite;
        }

        .item-notification-title {
            font-size: 20px;
            margin-bottom: 15px;
            text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.5);
        }

        .item-notification-description {
            font-size: 12px;
            line-height: 1.8;
            color: #ffd700;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .item-notification {
                padding: 30px 40px;
                max-width: 80%;
            }

            .item-notification-icon {
                font-size: 60px;
            }

            .item-notification-title {
                font-size: 16px;
            }

            .item-notification-description {
                font-size: 10px;
            }

            .bag-items {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 10px;
            }

            .bag-item {
                padding: 10px;
            }

            .bag-item-icon {
                font-size: 24px;
            }

            .bag-item-name {
                font-size: 8px;
            }

            .paper-title {
                font-size: 12px;
                margin-bottom: 20px;
            }

            .paper-text p {
                font-size: 9px;
                line-height: 1.8;
            }

            .password-display {
                font-size: 24px;
                padding: 20px 10px;
                letter-spacing: 6px;
            }

            .password-hint-text {
                font-size: 7px;
            }

            .unown-legend p:first-child {
                font-size: 12px !important;
                letter-spacing: 2px !important;
            }

            .unown-legend p:last-child {
                font-size: 6px !important;
                letter-spacing: 1px !important;
            }

            .bag-button-container {
                margin-top: 2vh;
                width: 100%;
            }

            .bag-button {
                padding: 8px 12px;
                font-size: 9px;
            }

            .paper-container {
                padding: 20px;
            }

            .close-paper-btn {
                padding: 10px 20px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
<div class="background-container"></div>
<div class="game-container">
    <div id="overlappingDiv" class="overlay"></div>
    <div class="gameboy" id="GameBoy">
        <div class="screen-area">
            <canvas class="display" id="mainCanvas"></canvas>
            <div id="characterDialogueBox" class="dialogue-box"></div>
            <div id="dialogueChoices" class="dialogue-choices" style="display: none;">
                <div class="choice-option" data-choice="yes">
                    <span class="choice-arrow">â†’</span>
                    <span class="choice-text">Oui</span>
                </div>
                <div class="choice-option" data-choice="no">
                    <span class="choice-arrow" style="visibility: hidden;">â†’</span>
                    <span class="choice-text">Non</span>
                </div>
            </div>
            <div id="userInterface" class="ui-container" style="display: none;">
                <div class="status-box enemy">
                    <h1 class="status-title"><span id="enemyName">Draggle</span> <span id="enemyLevel" style="font-size: 12px;">Lv5</span></h1>
                    <div class="health-bar-container">
                        <div class="health-bar-background"></div>
                        <div id="enemyHealthBar" class="health-bar"></div>
                    </div>
                </div>
                <div class="status-box player">
                    <h1 class="status-title"><span id="playerName">Emby</span> <span id="playerLevel" style="font-size: 12px;">Lv5</span></h1>
                    <div class="health-bar-container">
                        <div class="health-bar-background"></div>
                        <div id="playerHealthBar" class="health-bar"></div>
                    </div>
                    <div class="xp-bar-container" style="margin-top: 5px;">
                        <div style="font-size: 10px; margin-bottom: 2px;">
                            <span>XP: </span><span id="playerXP">0</span>/<span id="playerXPNeeded">50</span>
                        </div>
                        <div class="health-bar-background">
                            <div id="playerXPBar" class="xp-bar" style="width: 0%; background-color: #4CAF50;"></div>
                        </div>
                    </div>
                </div>
                <div class="battle-options">
                    <div id="dialogueBox" class="dialogue"></div>
                    <div id="attacksBox" class="attacks-box"></div>
                    <div class="attack-type-container">
                        <h1 id="attackType" class="attack-type-title">Attack Type</h1>
                    </div>
                </div>
            </div>
            <div id="userInterfaceTrainer" class="ui-container" style="display: none;">
                <div class="status-box enemy">
                    <h1 class="status-title"><span id="enemyNameTrainer">Dragkatchu</span> <span id="enemyLevelTrainer" style="font-size: 12px;">Lv5</span></h1>
                    <div class="health-bar-container">
                        <div class="health-bar-background"></div>
                        <div id="enemyHealthBarTrainer" class="health-bar"></div>
                    </div>
                </div>
                <div class="status-box player">
                    <h1 class="status-title"><span id="playerNameTrainer">Emby</span> <span id="playerLevelTrainer" style="font-size: 12px;">Lv5</span></h1>
                    <div class="health-bar-container">
                        <div class="health-bar-background"></div>
                        <div id="playerHealthBarTrainer" class="health-bar"></div>
                    </div>
                    <div class="xp-bar-container" style="margin-top: 5px;">
                        <div style="font-size: 10px; margin-bottom: 2px;">
                            <span>XP: </span><span id="playerXPTrainer">0</span>/<span id="playerXPNeededTrainer">50</span>
                        </div>
                        <div class="health-bar-background">
                            <div id="playerXPBarTrainer" class="xp-bar" style="width: 0%; background-color: #4CAF50;"></div>
                        </div>
                    </div>
                </div>
                <div class="battle-options">
                    <div id="dialogueBoxTrainer" class="dialogue"></div>
                    <div id="attacksBoxTrainer" class="attacks-box"></div>
                    <div class="attack-type-container">
                        <h1 id="attackTypeTrainer" class="attack-type-title">Attack Type</h1>
                    </div>
                </div>
            </div>
            <div class="label">
                <div class="title none">A$$ GAME</div>
                <div class="subtitle">
                    <span class="none c">C</span><!--
                    --><span class="o1 none">O</span><!--
                    --><span class="none l">L</span><!--
                    --><span class="none o2">O</span><!--
                    --><span class="none r">R</span>
                </div>
            </div>

            <!-- Inventory/Bag Interface -->
            <div id="bagInterface" class="bag-interface" style="display: none;">
                <div class="bag-header">
                    <h2>BAG</h2>
                    <p class="bag-instruction">Press I or tap to close</p>
                </div>
                <div class="bag-content">
                    <div id="bagItems" class="bag-items">
                        <!-- Items will be added here dynamically -->
                    </div>
                    <div id="emptyBagMessage" class="empty-bag-message">
                        Your bag is empty.
                    </div>
                </div>
            </div>

            <!-- Item Detail View (Paper with password) -->
            <div id="itemDetailView" class="item-detail-view" style="display: none;">
                <div class="paper-container">
                    <div class="paper-content">
                        <h3 class="paper-title">MYSTERIOUS NOTE</h3>
                        <div class="paper-text">
                            <p>Ancient Unown symbols reveal the secret password:</p>
                            <div class="password-display" id="passwordDisplay">pikasschu</div>
                            <p class="password-hint-text">(Decipher the Unown alphabet to read it)</p>
                            <div class="unown-legend">
                                <p style="font-family: 'Unown', monospace; font-size: 16px; letter-spacing: 3px; color: #1a0d06;">abcdefghijklmnopqrstuvwxyz</p>
                                <p style="font-family: 'Press Start 2P', cursive; font-size: 8px; letter-spacing: 2px; color: #666;">abcdefghijklmnopqrstuvwxyz</p>
                            </div>
                            <p class="paper-hint">Use this password to unlock the website!</p>
                        </div>
                    </div>
                    <button class="close-paper-btn">CLOSE</button>
                </div>
            </div>

            <!-- Item Received Notification -->
            <div id="itemNotification" class="item-notification">
                <div class="item-notification-icon" id="notificationIcon">ðŸŽ’</div>
                <div class="item-notification-title" id="notificationTitle">You received a BAG!</div>
                <div class="item-notification-description" id="notificationDescription">Press I to open your bag anytime!</div>
            </div>
        </div>
        <form onsubmit="event.preventDefault(); checkGameboyPassword();" class="nintendo">
            <input class="formSolana" type="text" id="gameboy-password" name="password" placeholder="Pa$$ word" required>
            <button type="submit">SOLANA</button>
        </form>

        <div class="controls">
            <div class="dpad">
                <div class="up"><i class="fa fa-caret-up"></i></div>
                <div class="right"><i class="fa fa-caret-right"></i></div>
                <div class="down"><i class="fa fa-caret-down"></i></div>
                <div class="left"><i class="fa fa-caret-left"></i></div>
                <div class="middle"></div>
            </div>
            <div class="a-b">
                <div class="b none">B</div>
                <div class="a none">A</div>
            </div>
            <div class="bag-button-container">
                <div class="bag-button" id="mobileBagButton">
                    <i class="fa fa-suitcase"></i> BAG
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Site content (hidden by default) -->
<div id="site-content" style="display: none;">
    <div class="container">
        <div class="row logoR">
            <div class="col-4"></div>
            <div class="col-6 mt-5">
                <a href="https://x.com/asskeetchumcoin?s=21">
                    <img src="img/token.png" class="img-fluid justify-content-end" alt="">
                </a>
            </div>
            <div class="col-1 mt-5">
                <a href="https://x.com/asskeetchumcoin?s=21">
                    <img src="img/tel.png" class="img-fluid justify-content-end" alt="">
                </a>
            </div>
            <div class="col-1 mt-5">
                <a href="https://x.com/asskeetchumcoin?s=21">
                    <img src="img/X.png" class="img-fluid d-block header-logo" alt="">
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row align-items-center my-row">
            <div class="col-2"></div>
            <div class="col-8">
                <div class="text-column mt-5 image-overlay-text text-beside-image">
                    <h2 class="ms-5">A$$ KEETCHUM!</h2>
                </div>
            </div>
            <div class="col-2"></div>
        </div>
    </div>

    <div class="row p-3 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-7">
                    <img class="img-fluid picka" src="img/pikatchoum.png" alt="Pikatchoum">
                </div>
                <div class="col-5">
                    <div class="container">
                        <div class="row align-items-center my-row">
                            <div class="text-column mt-5 image-overlay-text text-beside-image">
                                <h2>A$$!</h2>
                                <p>A$$ Keetchum! Embark on a blockchain adventure imbued with the indomitable spirit
                                    <br> of the ultimate PokÃ©mon Master. <span class="text-to-hide"> Get ready to
                                        not just catch PokÃ©mon, but <br> also the boundless potential of
                                        cryptocurrency! </span> Gonna catch 'em all!
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="black-band">
        <div class="row">
            <div class="col-12">
                <img src="img/adressTitle.png" alt="" class="img-fluid">
            </div>
            <div>
                <div class="contract-address">
                    <button class="button-wl" onclick="copyToClipboard()">
                        <span id="contractText">
                            <h2>FUYRMRSRV2FUJSSNY9GHCA97UBNEP1SDU5YRQSV4RZFR</h2>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-8">
                <img src="img/slem.webp" alt="Image Description" class="img-fluid picka mt-5">
            </div>
            <div class="col-4 mx-auto mxt">
                <div class="text-image-container">
                    <div class="text-beside-image">
                        <h2>JOIN THE </h2>
                        <h1>A$$!</h1>
                        <h2>COMMUNITY </h2>
                    </div>
                    <div class="row">
                        <div class="col-6 mt-5">
                            <a href="">
                                <img src="img/tel.png" class="img-fluid d-block header-logo justify-content-center"
                                    alt="">
                            </a>
                        </div>
                        <div class="col-6 mt-5">
                            <a href="https://x.com/asskeetchumcoin?s=21">
                                <img src="img/X.png" class="img-fluid d-block header-logo" alt="">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="PurpleBlack-band">
        <div class="container">
            <div class="row">
                <div class="col-4"></div>
                <div class="col-4 mxt">
                    <h1 class="htba">HOW TO BUY A$$!!!</h1>
                </div>
                <div class="col-4"></div>
                <div class="col-4"></div>
                <div class="col-4 mxt">
                    <img src="img/Ask.png" alt="">
                </div>
                <div class="col-4"></div>
                <div class="col-4 mxt">
                    <h2 class="htba">Creat SOLANA Wallet</h2>
                    <p class="htba">creer ton wallet sur Phanto suis simplement le guide</p>
                </div>
                <div class="col-2"></div>
                <div class="col-6 mxt">
                    <img src="img/wallet.png" alt="" class="logoR">
                </div>
                <div class="col-6">
                    <img src="img/solToken.png" alt="" class="logoR">
                </div>
                <div class="col-2"></div>
                <div class="col-4">
                    <h2 class="htba">Buy some SOL</h2>
                    <p class="htba">Bravo tu a crÃ©er ton wallet maintenant remplie le de SOL</p>
                </div>
                <div class="col-4">
                    <h2 class="htba">Swap your SOL to A$$</h2>
                    <p class="htba">Maintenant utilise Raydium afin de swap tes SOL en A$$</p>
                </div>
                <div class="col-2"></div>
                <div class="col-6">
                    <img src="img/Raydium.png" alt="" class="logoR">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Audio Paths Configuration -->
<div id="audioPaths" style="display: none;"
     data-map="./audio/map.ogg"
     data-init-battle="./audio/initBattle.wav"
     data-battle="./audio/battle.ogg"
     data-pump-trump="./audio/pumpTrump.ogg"
     data-tackle-hit="./audio/tackleHit.wav"
     data-fireball-hit="./audio/fireballHit.wav"
     data-init-fireball="./audio/initFireball.wav"
     data-victory="./audio/victory.wav"
     data-init-mexico="./audio/mexicoSong.ogg"
     data-mexico-hit="./audio/fireballHit.wav"
     data-init-ice="./audio/fahhSound.ogg"
     data-ice-hit="./audio/tackleHit.wav">
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
<script>window.gsap = gsap;</script>
<script src="data/classes.js?v=10"></script>
<script src="data/utils.js?v=10"></script>
<script src="data/attacks.js?v=10"></script>
<script src="data/monsters.js?v=10"></script>
<script src="data/characters.js?v=10"></script>
<script src="data/collisions.js?v=10"></script>
<script src="data/battleZones.js?v=10"></script>
<script src="data/audio.js?v=10"></script>
<script src="data/battleScene.js?v=10"></script>
<script src="data/trainer.js?v=10"></script>
<script src="data/index.js?v=10"></script>

<script>
    // Remplir le background avec du texte animÃ©
    function fillBackgroundWithText() {
        const container = document.querySelector('.background-container');
        if (!container) return;

        const text = 'A$$KEETCHUM ';
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const textHeight = 40;
        const verticalRepeats = Math.ceil(screenHeight / textHeight);

        container.innerHTML = '';

        for (let i = 0; i < verticalRepeats; i++) {
            const textLine = document.createElement('div');
            textLine.className = 'scrolling-text';
            textLine.textContent = text.repeat(Math.ceil(screenWidth / 100));
            if (i % 2 === 0) {
                textLine.classList.add('scroll-left-right');
            } else {
                textLine.classList.add('scroll-right-left');
            }
            textLine.style.top = `${i * textHeight}px`;
            container.appendChild(textLine);
        }
    }

    fillBackgroundWithText();
    window.addEventListener('resize', fillBackgroundWithText);

    // VÃ©rifier le code depuis le formulaire GameBoy
    function checkGameboyPassword() {
        const input = document.getElementById('gameboy-password').value.toLowerCase();
        const correctCode = 'pikasschu';

        if (input === correctCode) {
            localStorage.setItem('codeEntered', 'true');
            document.querySelector('.game-container').style.display = 'none';
            document.getElementById('site-content').style.display = 'block';
            alert('FÃ©licitations ! Code correct !');
        } else {
            alert('Code incorrect ! Parlez au dresseur aprÃ¨s avoir battu Dragkatchu.');
        }
    }

    // VÃ©rifier si le code est dÃ©jÃ  entrÃ©
    if (localStorage.getItem('codeEntered') === 'true') {
        document.querySelector('.game-container').style.display = 'none';
        document.getElementById('site-content').style.display = 'block';
    }

    // Fonction pour copier l'adresse du contrat
    function copyToClipboard() {
        const text = 'FUYRMRSRV2FUJSSNY9GHCA97UBNEP1SDU5YRQSV4RZFR';
        navigator.clipboard.writeText(text).then(() => {
            alert('Adresse copiÃ©e !');
        });
    }

    // ===== BAG/INVENTORY SYSTEM =====
    const bagSystem = {
        items: [],
        isOpen: false,

        init() {
            // Charger l'Ã©tat du sac depuis localStorage
            const hasReceivedBag = localStorage.getItem('hasReceivedBag');
            if (hasReceivedBag === 'true') {
                window.hasReceivedBag = true;
            }

            // Gestion de la touche "i" pour ouvrir/fermer le sac
            document.addEventListener('keydown', (e) => {
                if (e.key === 'i' || e.key === 'I') {
                    this.toggleBag();
                }
            });

            // Gestion du clic sur le sac pour le fermer
            document.getElementById('bagInterface').addEventListener('click', (e) => {
                if (e.target.id === 'bagInterface') {
                    this.closeBag();
                }
            });

            // Gestion du bouton de fermeture du papier
            document.querySelector('.close-paper-btn').addEventListener('click', () => {
                this.closeItemDetail();
            });

            // Gestion du clic sur le papier en arriÃ¨re-plan
            document.getElementById('itemDetailView').addEventListener('click', (e) => {
                if (e.target.id === 'itemDetailView') {
                    this.closeItemDetail();
                }
            });

            // Gestion du bouton BAG mobile
            const mobileBagButton = document.getElementById('mobileBagButton');
            if (mobileBagButton) {
                mobileBagButton.addEventListener('click', () => {
                    this.toggleBag();
                });
                mobileBagButton.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.toggleBag();
                });
            }

            // Cacher le bouton BAG initialement
            this.updateBagButtonVisibility();

            // VÃ©rifier rÃ©guliÃ¨rement l'Ã©tat pour mettre Ã  jour la visibilitÃ© du bouton
            setInterval(() => {
                this.updateBagButtonVisibility();

                // Fermer le sac si un combat commence pendant qu'il est ouvert
                if (this.isOpen && !this.canAccessBag()) {
                    this.closeBag();
                }
            }, 500);
        },

        canAccessBag() {
            // VÃ©rifier si le joueur a reÃ§u le sac de oldMan
            if (typeof window.hasReceivedBag === 'undefined' || !window.hasReceivedBag) {
                return false;
            }

            // VÃ©rifier si on n'est pas en combat
            if (typeof battle !== 'undefined' && battle.initiated) {
                return false;
            }

            return true;
        },

        toggleBag() {
            if (!this.canAccessBag()) {
                // Afficher un message si le joueur n'a pas encore le sac
                if (!window.hasReceivedBag) {
                    console.log("You need to get a BAG first! Talk to the old man on the left.");
                    // Optionnel: afficher une notification visuelle
                } else if (typeof battle !== 'undefined' && battle.initiated) {
                    console.log("Cannot open bag during battle!");
                }
                return;
            }

            if (this.isOpen) {
                this.closeBag();
            } else {
                this.openBag();
            }
        },

        openBag() {
            if (!this.canAccessBag()) {
                return;
            }

            this.isOpen = true;
            document.getElementById('bagInterface').style.display = 'block';
            this.renderItems();
        },

        closeBag() {
            this.isOpen = false;
            document.getElementById('bagInterface').style.display = 'none';
        },

        updateBagButtonVisibility() {
            const mobileBagButton = document.getElementById('mobileBagButton');
            if (mobileBagButton) {
                if (this.canAccessBag()) {
                    mobileBagButton.style.display = 'block';
                } else {
                    mobileBagButton.style.display = 'none';
                }
            }
        },

        addItem(item) {
            // VÃ©rifier si l'item n'existe pas dÃ©jÃ 
            if (!this.items.find(i => i.id === item.id)) {
                this.items.push(item);
                console.log('Item added to bag:', item);

                // Mettre Ã  jour la visibilitÃ© du bouton BAG
                this.updateBagButtonVisibility();

                // Afficher une notification
                this.showNotification(`You received: ${item.name}!`);
            }
        },

        showNotification(message) {
            // Use the global animated notification
            if (typeof window.showItemNotification === 'function') {
                window.showItemNotification('ðŸ“œ', message, 'Press I to open your bag');
            }
        },

        renderItems() {
            const bagItemsContainer = document.getElementById('bagItems');
            const emptyMessage = document.getElementById('emptyBagMessage');

            if (this.items.length === 0) {
                bagItemsContainer.style.display = 'none';
                emptyMessage.style.display = 'block';
            } else {
                bagItemsContainer.style.display = 'grid';
                emptyMessage.style.display = 'none';
                bagItemsContainer.innerHTML = '';

                this.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'bag-item';
                    itemDiv.innerHTML = `
                        <div class="bag-item-icon">${item.icon}</div>
                        <div class="bag-item-name">${item.name}</div>
                    `;
                    itemDiv.addEventListener('click', () => this.showItemDetail(item));
                    bagItemsContainer.appendChild(itemDiv);
                });
            }
        },

        showItemDetail(item) {
            document.getElementById('itemDetailView').style.display = 'flex';
            // On pourrait personnaliser le contenu selon l'item ici si nÃ©cessaire
        },

        closeItemDetail() {
            document.getElementById('itemDetailView').style.display = 'none';
        }
    };

    // Initialiser le systÃ¨me de sac quand le document est prÃªt
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            bagSystem.init();
        });
    } else {
        bagSystem.init();
    }

    // Rendre bagSystem globalement accessible
    window.bagSystem = bagSystem;
</script>
</body>
</html>
